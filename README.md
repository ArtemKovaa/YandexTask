# ШБР Лето 2023. Решение вступительного задания

Было выполнено 3 из 4 заданий.

## Документация

Описание всех эндпоинтов находится в файле openapi.json в корне проекта.

## Запуск проекта

1. Клонирование репозитория
```bash
git clone https://github.com/ArtemKovaa/YandexTask.git
cd YandexTask
```

2. Запуск Docker Compose
```bash
docker-compose up
```

## Технологический стек

- Java 17.
- Spring Boot — набор инструментов и библиотек для создания приложений корпоративного уровня.
- Spring Data — библиотека, которая добавляет дополнительный уровень абстракции поверх ORM реализации JPA.
- Lombok — библиотека для сокращения кода в классах.
- Flyway — инструмент миграции баз данных.
- Bucket4j — библиотека, реализующая алгоритм Token Bucket. Использована как основа для рейт лимитера.
- Docker — контейнеризатор приложений. Была реализована многоэтапная сборка проекта.

## Требования к сервису

В задании были реализованы следующие пункты:

1) REST API сервиса — подробнее в Задании 1;
2) Расчет рейтинга курьеров — подробнее в Задании 2;
3) Rate limiter для сервиса — подробнее в Задании 3;

## Задание 1. REST API

В качестве базовой функциональности сервиса были реализованы 7 базовых методов.

### POST /couriers

Эндпоинт для загрузки списка курьеров в систему.

### GET /couriers/{courier_id}

Возвращает информацию о курьере.

### GET /couriers

Возвращает информацию о всех курьерах.

### POST /orders

Эндпоинт для загрузки списка заказов в систему.


### GET /orders/{order_id}

Возвращает информацию о заказе по его идентификатору, а также дополнительную информацию: вес заказа, район доставки, 
промежутки времени, в которые удобно принять заказ.

### GET /orders

Возвращает информацию о всех заказах, а также их дополнительную информацию: вес заказа, район доставки, промежутки времени, в которые удобно принять заказ.

### POST /orders/complete

Принимает массив объектов, состоящий из трех полей: id курьера, id заказа и время выполнения заказа, после отмечает, что заказ выполнен.

## Задание 2. Рейтинг курьеров

### GET /couriers/meta-info/{courier_id}

Метод возвращает заработанные курьером деньги за заказы и его рейтинг.

**Заработок рассчитывается по формуле:**

Заработок рассчитывается как сумма оплаты за каждый завершенный развоз в период с `start_date` (включая) до 
`end_date` (исключая):

`sum = ∑(cost * C)`

`C`  — коэффициент, зависящий от типа курьера:
* пеший — 2
* велокурьер — 3
* авто — 4

**Рейтинг рассчитывается по формуле:**

Рейтинг рассчитывается следующим образом:
((число всех выполненных заказов с `start_date` по `end_date`) / (Количество часов между `start_date` и `end_date`)) * C
C - коэффициент, зависящий от типа курьера:
* пеший = 3
* велокурьер = 2
* авто - 1

## Задание 3. Rate limiter

Сервис ограничивает нагрузку в 10 RPS на каждый эндпоинт. Если допустимое количество запросов превышено, сервис отвечает кодом 429.
Реализация решения основана на Bucket4j